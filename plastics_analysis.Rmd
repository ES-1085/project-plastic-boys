---
title: "Fish Microplastics Analysis"
author: "Mabon Young, John Calzini, and Gordon Maguire"
date: "2/7/2024"
output: github_document
---

## Load packages and data

```{r load-packages, message=FALSE}
# install.packages("tidyverse")
# install.packages("readxl")
# install.packages("janitor")

library(tidyverse)
library(readxl)
library(janitor)
```

```{r load-dataset}
fish_microplastics <- read_xlsx("data/Fish_Microplastics_Data_Repository.xlsx", 
                                na = "NA") %>%
  janitor::clean_names() 

glimpse(fish_microplastics) 

#Sieve size is still a character, some of the entries have um after them, will need to figure out how to fix that later. Could also convert hot needle into a logical vector.
```

```{r fixdacolumns}
fish_microplastics <- fish_microplastics %>%
  mutate(sieve_size = str_extract(sieve_size, pattern = "[:digit:]+")) %>%
  mutate(sieve_size = case_when(sieve_size == "LG" ~ 777,
          TRUE ~ as.numeric(sieve_size))) %>%
  mutate(hot_needle = case_when(hot_needle == "yes" ~ TRUE, hot_needle == "no" ~ FALSE))
```


```{r ,fig.alt="This histogram shows the distribution of colored microplastics within the fish. The overwhelming majority of microplastics found were transparent with Black and blue being the second and third most common color."}
ggplot(data = fish_microplastics, mapping = aes(x = net_sample_mass_g)) +
  geom_histogram(binwidth = 1000) + 
  facet_wrap(~color) 
#You could also present this information in a bar graph, a histogram with a binwidth of 1000 will always be just 1 bar. Also, I wonder why we're seeing negative values? It's probably a result of overly large binwidth, but maybe ask Laurie about that.

ggplot(data = fish_microplastics, mapping = aes(x = net_sample_mass_g)) +
  geom_histogram(binwidth = 5) + 
  facet_wrap(~color) 

# This graph still isn't telling us that much; remember, the net sample mass isn't the mass of the plastic, it's the mass of the sample the plastic was taken from. It could still be helpful if we wanted to look at microplastic density, though! 
plastic_dens <- fish_microplastics %>%
  group_by(fish_id) %>%
  reframe(plastic_density = sum(quantity)/net_sample_mass_g, na.rm = TRUE, sample_type) %>%
  distinct(fish_id, sample_type, plastic_density)

fish_microplastics_dens <- fish_microplastics %>%
  mutate(plastic_density = quantity/net_sample_mass_g)
```

```{r}
fish_microplastics %>%
  group_by(color) %>%
  summarize(
    avg_ht = mean(quantity, na.rm = TRUE)
    ) %>% 
  arrange(desc(avg_ht)) %>% 
slice(1:5) 
```
```{r}
fish_microplastics %>% 
group_by(color) %>%
  summarize(
    avg_ht = mean(quantity, na.rm = TRUE), median = median(quantity, na.rm = TRUE), min = min(quantity, na.rm = TRUE), max = max(quantity, na.rm = TRUE), sd = sd(quantity, na.rm = TRUE), IQR = IQR(quantity, na.rm = TRUE)
    )

#That 109 one is a bit terrifying... maybe we could hone in on that fish and see if there's anything unique about it in the spatial data?
```
```{r add-station}
fish_microplastics_full <- fish_microplastics_dens %>%
  mutate(station = case_when(collection_lat == 27.31513 ~ "Sarasota", 
                             collection_lat == 27.42136 ~ "Longboat Key"))
```

```{r dens-by-station, fig.alt= "A bar chart of microplastic quantity by sample mass for the Longboat Key and Sarasota sampling stations showing that microplastics are much more abundant in the Longboat Key samples, even at low sample masses."}
fish_microplastics_full %>%
  ggplot(aes(x = net_sample_mass_g, y = quantity, fill = sample_type)) +
  geom_col() +
  facet_wrap(~station)
```


